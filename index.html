<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <script type="text/javascript" src="w2g.js"></script>
      <title>MarkedMap</title>

      <link rel="manifest" href="manifest.json" />
      

      <style type="text/css">
            :root {
                  --panel-bg: rgba(255, 255, 255, 0.7);
                  --panel-border: rgba(0, 0, 0, 0.08);
                  --text: #111;
                  --muted: #666;
                  --primary: #2563eb;
                  --primary-contrast: #fff;
                  --danger: #dc2626;
                  --radius: 12px;
                  --shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            }

            html,
            body {
                  height: 100%;
                  margin: 0;
                  padding: 0;
                  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
                  color: var(--text);
                  -webkit-font-smoothing: antialiased;
                  -moz-osx-font-smoothing: grayscale;
            }

            #container {
                  width: 100%;
                  height: 100%;
            }

            /* Modern top-right control panel */
            #markDetail.control-panel {
                  position: fixed;
                  top: 12px;
                  right: 12px;
                  z-index: 9999;
                  display: flex;
                  flex-direction: column;
                  gap: 6px;
                  padding: 10px;
                  background: var(--panel-bg);
                  border: 1px solid var(--panel-border);
                  border-radius: var(--radius);
                  box-shadow: var(--shadow);
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  max-width: min(92vw, 360px);
            }

            .panel-row {
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  flex-wrap: wrap;
            }

            .input {
                  flex: 1 1 auto;
                  min-width: 120px;
                  padding: 8px 10px;
                  border-radius: 10px;
                  border: 1px solid var(--panel-border);
                  background: rgba(255, 255, 255, 0.9);
                  outline: none;
            }
            .input:focus { border-color: #c3dafe; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15); }

            .btn {
                  padding: 8px 12px;
                  border-radius: 10px;
                  border: 1px solid var(--panel-border);
                  background: #fff;
                  color: var(--text);
                  cursor: pointer;
                  transition: transform 0.06s ease, background 0.2s ease, box-shadow 0.2s ease;
            }
            .btn:hover { background: #f8fafc; }
            .btn:active { transform: translateY(1px); }
            .btn.primary { background: var(--primary); color: var(--primary-contrast); border-color: transparent; }
            .btn.primary:hover { filter: brightness(0.95); }
            .btn.secondary { background: #f3f4f6; }
            .btn.danger { background: #fee2e2; color: var(--danger); border-color: #fecaca; }

            .icon-btn { padding: 8px 10px; border-radius: 10px; border: 1px solid var(--panel-border); background: #fff; cursor: pointer; }

            /* Dropdown */
            .dropdown { position: relative; }
            .dropdown-menu {
                  position: absolute;
                  top: 100%;
                  right: 0;
                  display: none;
                  margin-top: 6px;
                  padding: 6px;
                  background: rgba(255, 255, 255, 0.98);
                  border: 1px solid var(--panel-border);
                  border-radius: 10px;
                  box-shadow: var(--shadow);
                  min-width: 160px;
            }
            .dropdown-menu .btn, .dropdown-menu a.btn { width: 100%; text-align: left; margin: 4px 0; }

            /* Search panel */
            .search-panel { display: none; }
            .results { list-style: none; padding: 0; margin: 6px 0 0 0; max-height: 40vh; overflow: auto; }
            .results li { padding: 6px 8px; border: 1px solid var(--panel-border); border-radius: 10px; background: #fff; margin-bottom: 6px; cursor: pointer; }
            .results li:hover { background: #f8fafc; }
            .result-title { font-weight: 600; }
            .result-sub { color: var(--muted); font-size: 12px; margin-top: 2px; }

            .pill {
                  padding: 6px 10px;
                  border-radius: 999px;
                  background: #f3f4f6;
                  color: var(--muted);
                  font-size: 12px;
            }

            .details {
                  list-style: none;
                  padding: 8px;
                  margin: 4px 0 0 0;
                  border-radius: 10px;
                  background: rgba(255, 255, 255, 0.85);
                  border: 1px solid var(--panel-border);
            }
            .details li { margin-bottom: 8px; }
            .details input, .details textarea { width: 100%; box-sizing: border-box; }

            #showCurrent {
                  position: fixed;
                  left: 10%;
                  bottom: 30%;
                  z-index: 10000;
                  background-color: rgba(0, 0, 0, 0);
                  border-width: 0;
                  width: 8vw;
                  height: 8vw;
                  background-image: url("./current-location.svg");
            }

            #arrowdiv {
                  position: fixed;
                  left: 0;
                  top: 0;
                  width: 8vw;
                  height: 8vw;
                  background-repeat: no-repeat;
                  background-size: cover;
                  background-image: url("./arrow-right.png");
            }

            /* Modal */
            .modal-backdrop {
                  position: fixed;
                  inset: 0;
                  background: rgba(0,0,0,0.35);
                  display: none;
                  align-items: center;
                  justify-content: center;
                  z-index: 10001;
            }
            .modal {
                  width: min(92vw, 560px);
                  max-height: 80vh;
                  overflow: auto;
                  background: #fff;
                  border-radius: var(--radius);
                  box-shadow: var(--shadow);
                  border: 1px solid var(--panel-border);
                  padding: 14px;
            }
            .modal h3 { margin: 6px 0 10px 0; }
            .modal .hint { color: var(--muted); font-size: 12px; }
            .modal textarea { width: 100%; box-sizing: border-box; }
      </style>
      <script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=ZMFBZ-JCICK-WUBJ3-ACSIA-CJYS7-YMBRS"></script>
      <!-- <script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script> -->
      <script src="./main.js" defer ></script>

</head>

<body>
      <button id="showCurrent"></button>

      <div id="markDetail" class="control-panel">
            <div class="panel-row">
                  <div id="postionDisplay" class="pill">lat ,lng</div>
            </div>
            <div class="panel-row">
                  <button id="hideDetail" class="icon-btn" title="Toggle details">Details</button>
                  <button id="deleteMark" class="btn danger" title="Delete selected">Delete</button>
                  <div class="dropdown" style="margin-left:auto">
                        <button id="moreButton" class="btn" title="More">More ▾</button>
                        <div id="moreMenu" class="dropdown-menu">
                              <button id="searchButton" class="btn" title="Search nearby">Search nearby</button>
                              <button id="exportButton" class="btn" title="Export labels">Export</button>
                              <button id="importButton" class="btn secondary" title="Import labels">Import</button>
                              <button id="enableSensors" class="btn" title="Enable compass">Compass</button>
                        </div>
                  </div>
            </div>

            <div id="searchPanel" class="search-panel">
                  <div class="panel-row">
                        <input id="searchInput" class="input" placeholder="Keyword, e.g. 公园 / 餐厅" />
                        <button id="searchGo" class="btn primary">Go</button>
                  </div>
                  <ul id="searchResults" class="results"></ul>
            </div>

            <ul id="markDetailUl" class="details">
                  <li><input id="labelIdInput" class="input" placeholder="ID" /></li>
                  <li>
                        <input id="labelNameInput" class="input" placeholder="Label name" />
                  </li>
                  <li>
                        <textarea id="labelDetailInput" class="input" rows="4" placeholder="Detail"></textarea>
                  </li>
                  <li>
                        <button id="labelSaveButton" class="btn primary">Save</button>
                  </li>
            </ul>
      </div>
      <div id="container"></div>
            <div id="arrowdiv"></div>

      <!-- Import Modal -->
      <div id="importModal" class="modal-backdrop">
            <div class="modal">
                  <h3>Import Labels</h3>
                  <div class="hint">Paste JSON or choose a file. Default action merges with existing labels.</div>
                  <div class="panel-row" style="margin-top:8px">
                        <input type="file" id="importFile" accept="application/json,.json" class="input" />
                  </div>
                  <div class="panel-row" style="margin-top:6px">
                        <textarea id="importInput" class="input" rows="8" placeholder='{"id": {"id":"...","name":"...","lat":0,"lng":0}}'></textarea>
                  </div>
                  <div class="panel-row" style="margin-top:6px">
                        <label class="pill"><input type="checkbox" id="replaceExisting" /> Replace existing labels</label>
                        <span style="margin-left:auto"></span>
                        <button id="importCancel" class="btn">Cancel</button>
                        <button id="importConfirm" class="btn primary">Import</button>
                  </div>
            </div>
      </div>

      <!-- Export Modal -->
      <div id="exportModal" class="modal-backdrop">
            <div class="modal">
                  <h3>Export Labels</h3>
                  <div id="exportMeta" class="pill">0 labels</div>
                  <div class="panel-row" style="margin-top:6px">
                        <textarea id="exportOutput" class="input" rows="8" readonly></textarea>
                  </div>
                  <div class="panel-row" style="margin-top:6px">
                        <button id="exportClose" class="btn">Close</button>
                        <button id="exportCopy" class="btn">Copy</button>
                        <button id="exportDownload" class="btn primary">Download</button>
                  </div>
            </div>
      </div>


</body>

</html>
